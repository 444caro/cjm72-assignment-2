<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMeans Clustering Visualization</title>
    <style>
        #cluster-image {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>KMeans Clustering Visualization</h1>

    <label for="n_clusters">Number of Clusters:</label>
    <input type="number" id="n_clusters" name="n_clusters" value="3" min="1"><br>

    <label for="init_method">Initialization Method:</label>
    <select id="init_method">
        <option value="random">Random</option>
        <option value="kmeans++">KMeans++</option>
        <option value="farthest">Farthest First</option>
    </select><br><br>

    <button id="generate-clusters">Generate Clusters</button>

    <div id="cluster-plot">
        <img id="cluster-image" alt="Cluster Plot" />
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const generateClustersButton = document.getElementById('generate-clusters');

            generateClustersButton.addEventListener('click', function() {
                const nClusters = document.getElementById('n_clusters').value;
                const initMethod = document.getElementById('init_method').value;

                // Example dataset, can be dynamically generated or loaded via file
                const data = [
                    [1.0, 2.0], [1.5, 1.8], [5.0, 8.0],
                    [8.0, 8.0], [1.0, 0.6], [9.0, 11.0]
                ];

                // Prepare the POST request payload
                const payload = JSON.stringify({
                    data: data,
                    n_clusters: parseInt(nClusters),
                    init_method: initMethod
                });

                // Send the POST request to the Flask API
                fetch('/api/kmeans', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: payload
                })
                .then(response => {
                    if (response.ok) {
                        // Append a timestamp to prevent caching
                        document.getElementById('cluster-image').src = '/api/kmeans?' + new Date().getTime();
                    } else {
                        return response.json().then(err => {
                            console.error("Error generating clusters:", err.error);
                        });
                    }
                })
                .catch(error => {
                    console.error("Network error:", error);
                });
            });
        });
    </script>
</body>
</html>
